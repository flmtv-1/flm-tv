<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.12"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; }
        #video { width: 100vw; height: 100vh; object-fit: contain; }
        #loading { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; color: #fff; background: #000; z-index: 999; }
        .spinner { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #0f0; border-radius: 50%; animation: spin 0.6s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<video id="video" controls></video>
<div id="loading"><div class="spinner"></div></div>

<script>
const CONFIG = {
    SERVER: 'https://flmtv26.duckdns.org:8920',
    API_KEY: '24674385633844efbe3a1367b8f63d43'
};

const itemId = new URLSearchParams(window.location.search).get('id');
const video = document.getElementById('video');
const loading = document.getElementById('loading');

if (!itemId) {
    loading.innerHTML = '<p style="color:#f00">No video ID</p>';
} else {
    // Try direct MP4 stream first (most reliable)
    const streamUrl = `${CONFIG.SERVER}/Videos/${itemId}/stream.mp4?Static=true&api_key=${CONFIG.API_KEY}`;
    
    console.log('Stream URL:', streamUrl);
    
    video.src = streamUrl;
    
    video.addEventListener('canplay', () => {
        loading.style.display = 'none';
        video.play().catch(e => console.log('Autoplay prevented'));
    });
    
    video.addEventListener('error', (e) => {
        console.error('Video error:', video.error);
        loading.innerHTML = '<p style="color:#f00">Playback error. Please try another video.</p>';
    });
}
</script>

</body>
</html>
