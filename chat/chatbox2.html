<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLM TV Chat</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a; /* Dark background */
            color: #ffffff; /* White text */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden; /* Prevent body scroll */
        }
        #chat-container {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            padding: 10px 0 0 0; /* Top padding, no side or bottom padding here */
            box-sizing: border-box;
            background-color: #282828; /* Slightly lighter than body for contrast */
            border-radius: 8px;
            margin: 5px; /* Margin to keep it slightly off the edges if needed by iframe */
            overflow: hidden; /* To handle internal scrolling */
        }
        #messages {
            flex-grow: 1;
            overflow-y: auto; /* Enable scrolling for messages */
            padding: 0 10px 10px 10px; /* Padding for messages area */
            display: flex;
            flex-direction: column;
            gap: 10px; /* Space between messages */
            scroll-behavior: smooth;
        }
        .message {
            background-color: #3a3a3a; /* Darker background for messages */
            padding: 8px 12px;
            border-radius: 5px;
            max-width: 80%;
            word-wrap: break-word;
        }
        .message.mine {
            background-color: #007bff; /* Blue for my messages */
            align-self: flex-end; /* Align to right */
        }
        .message.other {
            background-color: #555555; /* Grey for other messages */
            align-self: flex-start; /* Align to left */
        }
        .message-username {
            font-size: 0.8em;
            color: #bbb;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .message-content {
            font-size: 0.95em;
        }
        .chat-input-area {
            display: flex;
            padding: 10px;
            border-top: 1px solid #333;
            background-color: #222;
        }
        #message-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #555;
            border-radius: 5px;
            background-color: #3a3a3a;
            color: white;
            outline: none;
            font-size: 1em;
        }
        #message-input::placeholder {
            color: #aaa;
        }
        #send-message-button, #emoji-toggle-button {
            background-color: #e50914; /* Red color */
            color: white;
            border: none;
            padding: 10px 15px;
            margin-left: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2em;
            transition: background-color 0.2s;
            flex-shrink: 0; /* Prevent button from shrinking */
        }
        #send-message-button:hover, #emoji-toggle-button:hover {
            background-color: #b8070f;
        }
        .chat-header {
            background-color: #1a1a1a;
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #333;
            position: relative;
        }
        .chat-header h3 {
            margin: 0;
            color: white;
        }
        /* Username Modal */
        .modal {
            display: flex;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #282828;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            width: 90%;
            max-width: 350px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .modal-content h2 {
            margin-bottom: 20px;
            color: white;
        }
        .modal-content input {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #555;
            border-radius: 5px;
            background-color: #3a3a3a;
            color: white;
            outline: none;
        }
        .modal-content button {
            background-color: #e50914;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s;
        }
        .modal-content button:hover {
            background-color: #b8070f;
        }

        /* Emoji Picker */
        .emoji-picker {
            display: none; /* Hidden by default */
            position: absolute;
            bottom: 60px; /* Adjust based on input area height */
            right: 10px;
            background-color: #3a3a3a;
            border: 1px solid #555;
            border-radius: 8px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            z-index: 10;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(30px, 1fr));
            gap: 5px;
        }
        .emoji-picker span {
            cursor: pointer;
            font-size: 1.2em;
            padding: 3px;
            text-align: center;
            border-radius: 3px;
            transition: background-color 0.1s;
        }
        .emoji-picker span:hover {
            background-color: #555;
        }
    </style>
</head>
<body>
    <div id="username-modal" class="modal">
        <div class="modal-content">
            <h2>Enter Your Username</h2>
            <input type="text" id="username-input" placeholder="e.g., ChatMaster">
            <button id="save-username-button">Start Chatting</button>
        </div>
    </div>

    <div id="chat-container">
        <div class="chat-header">
            <h3>Community Chat</h3>
            </div>
        <div id="messages">
            </div>
        <div class="chat-input-area">
            <input type="text" id="message-input" placeholder="Type your message...">
            <button id="emoji-toggle-button"><i class="far fa-smile"></i></button>
            <button id="send-message-button"><i class="fas fa-paper-plane"></i></button>
        </div>
        <div id="emoji-picker-container" class="emoji-picker">
            </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script>
        // Firebase configuration (REPLACE WITH YOUR ACTUAL CONFIG)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY", // Make sure to update this!
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const messagesCollection = db.collection('chatMessages');

        const usernameModal = document.getElementById('username-modal');
        const usernameInput = document.getElementById('username-input');
        const saveUsernameButton = document.getElementById('save-username-button');
        const messagesDisplay = document.getElementById('messages');
        const messageInput = document.getElementById('message-input');
        const sendMessageButton = document.getElementById('send-message-button');
        const emojiToggleButton = document.getElementById('emoji-toggle-button');
        const emojiPickerContainer = document.getElementById('emoji-picker-container');

        let username = localStorage.getItem('chatUsername');

        // --- Username Modal Logic ---
        if (!username) {
            usernameModal.style.display = 'flex';
        }

        saveUsernameButton.addEventListener('click', () => {
            const enteredUsername = usernameInput.value.trim();
            if (enteredUsername) {
                username = enteredUsername;
                localStorage.setItem('chatUsername', username);
                usernameModal.style.display = 'none';
            } else {
                alert('Please enter a username!');
            }
        });

        // --- Chat Message Functions ---
        function displayMessage(doc) {
            const message = doc.data();
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');

            if (message.username === username) {
                messageElement.classList.add('mine');
            } else {
                messageElement.classList.add('other');
            }

            messageElement.innerHTML = `
                <div class="message-username">${message.username}</div>
                <div class="message-content">${message.text}</div>
            `;
            messagesDisplay.appendChild(messageElement);
            // Scroll to the latest message
            messagesDisplay.scrollTop = messagesDisplay.scrollHeight;
        }

        // Listen for new messages in real-time
        messagesCollection.orderBy('timestamp', 'asc').limitToLast(50) // Limit to last 50 messages
            .onSnapshot(snapshot => {
                snapshot.docChanges().forEach(change => {
                    if (change.type === 'added') {
                        displayMessage(change.doc);
                    }
                });
            }, error => {
                console.error("Error listening to messages: ", error);
            });

        sendMessageButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        function sendMessage() {
            const messageText = messageInput.value.trim();
            if (messageText && username) {
                messagesCollection.add({
                    username: username,
                    text: messageText,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp() // Use server timestamp
                })
                .then(() => {
                    messageInput.value = ''; // Clear input
                    emojiPickerContainer.style.display = 'none'; // Hide emoji picker after sending
                })
                .catch((error) => {
                    console.error("Error writing message: ", error);
                });
            } else if (!username) {
                alert('Please set your username first!');
                usernameModal.style.display = 'flex';
            }
        }

        // --- Emoji Picker Logic ---
        const emojis = [
            'ðŸ˜€', 'ðŸ˜ƒ', 'ðŸ˜„', 'ðŸ˜', 'ðŸ˜†', 'ðŸ˜…', 'ðŸ˜‚', 'ðŸ¤£', 'ðŸ˜Š', 'ðŸ˜‡', 'ðŸ™‚', 'ðŸ™ƒ', 'ðŸ˜‰', 'ðŸ˜Œ', 'ðŸ˜', 'ðŸ¥°', 'ðŸ˜˜', 'ðŸ˜—', 'ðŸ˜™', 'ðŸ˜š',
            'ðŸ˜‹', 'ðŸ˜›', 'ðŸ˜œ', 'ðŸ¤ª', 'ðŸ˜', 'ðŸ¤—', 'ðŸ¤­', 'ðŸ¤«', 'ðŸ¤”', 'ðŸ¤', 'ðŸ¤¨', 'ðŸ˜', 'ðŸ˜‘', 'ðŸ˜¶', 'ðŸ˜', 'ðŸ˜’', 'ðŸ™„', 'ðŸ˜¬', 'ðŸ¤¥', 'ðŸ˜Œ',
            'ðŸ˜”', 'ðŸ˜Ÿ', 'ðŸ˜ ', 'ðŸ˜¡', 'ðŸ¤¬', 'ðŸ¥º', 'ðŸ˜¤', 'ðŸ˜¢', 'ðŸ˜­', 'ðŸ˜¥', 'ðŸ˜¥', 'ðŸ˜¥', 'ðŸ˜¥', 'ðŸ˜¥', 'ðŸ˜¥', 'ðŸ˜¥', 'ðŸ˜¥', 'ðŸ˜¥', 'ðŸ˜¥', 'ðŸ˜¥',
            'ðŸ˜°', 'ðŸ˜¨', 'ðŸ˜±', 'ðŸ˜–', 'ðŸ˜£', 'ðŸ˜©', 'ðŸ˜«', 'ðŸ˜´', 'ðŸ¤¤', 'ðŸ˜ª', 'ðŸ˜µ', 'ðŸ¤¯', 'ðŸ¤ ', 'ðŸ¥³', 'ðŸ˜Ž', 'ðŸ¤“', 'ðŸ§', 'ðŸ˜•', 'ðŸ˜Ÿ', 'ðŸ™',
            'ðŸ˜®', 'ðŸ˜²', 'ðŸ˜³', 'ðŸ¥º', 'ðŸ˜¦', 'ðŸ˜§', 'ðŸ˜¨', 'ðŸ˜¥', 'ðŸ˜¢', 'ðŸ˜­', 'ðŸ˜±', 'ðŸ˜–', 'ðŸ˜£', 'ðŸ˜ž', 'ðŸ˜“', 'ðŸ˜©', 'ðŸ˜«', 'ðŸ˜¤', 'ðŸ˜¡', 'ðŸ˜ ',
            'ðŸ˜·', 'ðŸ¤’', 'ðŸ¤•', 'ðŸ¤¢', 'ðŸ¤®', 'ðŸ¤§', 'ðŸ˜‡', 'ðŸ¥³', 'ðŸ¥°', 'ðŸ˜˜', 'ðŸ˜—', 'ðŸ˜™', 'ðŸ˜š', 'ðŸ™‚', 'ðŸ™ƒ', 'ðŸ˜‰', 'ðŸ˜Œ', 'ðŸ˜', 'ðŸ˜†', 'ðŸ˜‚',
            'ðŸ¤£', 'ðŸ˜…', 'ðŸ˜‹', 'ðŸ˜›', 'ðŸ˜œ', 'ðŸ¤ª', 'ðŸ˜', 'ðŸ¤‘', 'ðŸ¤­', 'ðŸ¤«', 'ðŸ¤”', 'ðŸ¤', 'ðŸ¤¨', 'ðŸ˜', 'ðŸ˜‘', 'ðŸ˜¶', 'ðŸ˜', 'ðŸ˜’', 'ðŸ™„', 'ðŸ˜¬',
            'ðŸ¤¥', 'ðŸ˜Œ', 'ðŸ˜”', 'ðŸ˜Ÿ', 'ðŸ˜ ', 'ðŸ˜¡', 'ðŸ¤¬', 'ðŸ¥º', 'ðŸ˜¤', 'ðŸ˜¢', 'ðŸ˜­', 'ðŸ˜¥', 'ðŸ˜°', 'ðŸ˜¨', 'ðŸ˜±', 'ðŸ˜–', 'ðŸ˜£', 'ðŸ˜©', 'ðŸ˜«', 'ðŸ˜´',
            'ðŸ¤¤', 'ðŸ˜ª', 'ðŸ˜µ', 'ðŸ¤¯', 'ðŸ¤ ', 'ðŸ¥³', 'ðŸ˜Ž', 'ðŸ¤“', 'ðŸ§', 'ðŸ˜•', 'ðŸ˜Ÿ', 'ðŸ™', 'ðŸ˜®', 'ðŸ˜²', 'ðŸ˜³', 'ðŸ¥º', 'ðŸ˜¦', 'ðŸ˜§', 'ðŸ«¨', 'ðŸ« ', 'ðŸ¥¹',
            'ðŸ¤', 'ðŸ‘', 'ðŸ‘Ž', 'ðŸ‘', 'ðŸ™Œ', 'ðŸ¤²', 'ðŸ™', 'âœï¸', 'ðŸ’…', 'ðŸ¤³', 'ðŸ’ª', 'ðŸ¦µ', 'ðŸ¦¶', 'ðŸ‘‚', 'ðŸ‘ƒ', 'ðŸ§ ', 'ðŸ«€', 'ðŸ«', 'ðŸ¦´', 'ðŸ‘€',
            'ðŸ—£ï¸', 'ðŸ‘¤', 'ðŸ‘¥', 'ðŸ«‚', 'ðŸ‘ª', 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§', 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘¦â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘§', 'ðŸ‘¨â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘¦â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘§', 'ðŸ‘¨â€ðŸ‘§â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘§â€ðŸ‘§',
            'ðŸ‘©â€ðŸ‘¦', 'ðŸ‘©â€ðŸ‘¦â€ðŸ‘¦', 'ðŸ‘©â€ðŸ‘§', 'ðŸ‘©â€ðŸ‘§â€ðŸ‘¦', 'ðŸ‘©â€ðŸ‘§â€ðŸ‘§', 'ðŸ’”', 'â¤ï¸', 'ðŸ§¡', 'ðŸ’›', 'ðŸ’š', 'ðŸ’™', 'ðŸ’œ', 'ðŸ¤Ž', 'ðŸ–¤', 'ðŸ¤', 'ðŸ’¯', 'ðŸ’¢', 'ðŸ’¥', 'ðŸ’«', 'ðŸ’¦', 'ðŸ’¨',
            'ðŸ’©', 'ðŸ‘»', 'ðŸ‘½', 'ðŸ¤–', 'ðŸŽƒ', 'ðŸ˜º', 'ðŸ˜¸', 'ðŸ˜¹', 'ðŸ˜»', 'ðŸ˜¼', 'ðŸ˜½', 'ðŸ™€', 'ðŸ˜¿', 'ðŸ˜¾', 'ðŸ™ˆ', 'ðŸ™‰', 'ðŸ™Š', 'ðŸ¸', 'ðŸ¢', 'ðŸ',
            'ðŸ¦Ž', 'ðŸ¦–', 'ðŸ¦•', 'ðŸ¦‚', 'ðŸ•·ï¸', 'ðŸ•¸ï¸', 'ðŸ¦—', 'ðŸœ', 'ðŸ¦Ÿ', 'ðŸ¦ ', 'ðŸª°', 'ðŸª±', 'ðŸŒ', 'ðŸ¦‹', 'ðŸ›', 'ðŸ', 'ðŸž', 'ðŸª²', 'ðŸª³', 'ðŸ§…',
            'ðŸ¥”', 'ðŸ ', 'ðŸ¥•', 'ðŸŒ½', 'ðŸŒ¶ï¸', 'ðŸ¥’', 'ðŸ¥¬', 'ðŸ¥¦', 'ðŸ§„', 'ðŸ§…', 'ðŸ„', 'ðŸŒ°', 'ðŸ¥œ', 'ðŸž', 'ðŸ¥', 'ðŸ¥–', 'ðŸ¥¨', 'ðŸ¥¯', 'ðŸ¥ž', 'ðŸ§‡',
            'ðŸ§€', 'ðŸ–', 'ðŸ—', 'ðŸ¥©', 'ðŸ¥“', 'ðŸ”', 'ðŸŸ', 'ðŸ•', ' hotdog', 'ðŸŒ­', 'ðŸ¥ª', 'ðŸŒ®', 'ðŸŒ¯', 'ðŸ¥™', 'ðŸ§†', 'ðŸ¥š', 'ðŸ³', 'ðŸ¥˜', 'ðŸ²', 'ðŸœ',
            'ðŸ›', 'ðŸ£', 'ðŸ±', 'ðŸ¤', 'ðŸ™', 'ðŸš', 'ðŸ˜', 'ðŸ¥', 'ðŸ¥ ', 'ðŸ¥®', 'ðŸ¢', 'ðŸ¡', 'ðŸ§', 'ðŸ¨', 'ðŸ¦', 'ðŸ¥§', 'ðŸ°', 'ðŸŽ‚', 'ðŸ®', 'ðŸ­',
            'ðŸ¬', 'ðŸ«', 'ðŸ¿', 'ðŸ©', 'ðŸª', 'ðŸ¥›', 'ðŸ¼', 'â˜•', 'ðŸµ', 'ðŸ¶', 'ðŸ¾', 'ðŸ·', 'ðŸ¸', 'ðŸ¹', 'ðŸº', 'ðŸ»', 'ðŸ¥‚', 'ðŸ¥ƒ', 'ðŸ¥¤', 'ðŸ§‹',
            'ðŸ§Š', 'ðŸ©', 'ðŸª', 'ðŸ¥›', 'ðŸ¼', 'â˜•', 'ðŸµ', 'ðŸ¶', 'ðŸ¾', 'ðŸ·', 'ðŸ¸', 'ðŸ¹', 'ðŸº', 'ðŸ»', 'ðŸ¥‚', 'ðŸ¥ƒ', 'ðŸ¥¤', 'ðŸ§‹', 'ðŸ§ƒ', 'ðŸ§‰',
            'ðŸ’§', 'ðŸŒŠ', 'ðŸŒ¬ï¸', 'ðŸ’¨', 'â˜”', 'â˜‚ï¸', 'ðŸŒˆ', 'â˜€ï¸', 'â˜ï¸', 'â›…', 'â›ˆï¸', 'ðŸŒ¨ï¸', 'â„ï¸', 'â˜ƒï¸', 'â›„', 'ðŸ”¥', 'âš¡', 'ðŸ’¥', 'ðŸ’«', 'â­',
            'ðŸŒŸ', 'âœ¨', 'âš¡', 'â˜„ï¸', 'ðŸŒ‘', 'ðŸŒ’', 'ðŸŒ“', 'ðŸŒ”', 'ðŸŒ•', 'ðŸŒ–', 'ðŸŒ—', 'ðŸŒ˜', 'ðŸŒ™', 'ðŸŒ', 'ðŸŒŽ', 'ðŸŒ', 'ðŸŒ', 'ðŸ—ºï¸', 'ðŸ§­', 'ðŸ”ï¸', 'â›°ï¸',
            'ðŸŒ‹', 'ðŸ—»', 'ðŸ•ï¸', 'ðŸ–ï¸', 'ðŸœï¸', 'ðŸï¸', 'ðŸžï¸', 'ðŸŸï¸', 'ðŸ›ï¸', 'ðŸ—ï¸', 'ðŸ˜ï¸', 'ðŸ™ï¸', 'ðŸšï¸', 'ðŸ¢', 'ðŸ­', 'â›ª', 'ðŸ•Œ', 'ðŸ›•', 'ðŸ•', 'â›©ï¸',
            'ðŸ•‹', 'â›²', 'â›º', 'ðŸ›º', 'ðŸš‚', 'ðŸšƒ', 'ðŸš„', 'ðŸš…', 'ðŸš†', 'ðŸš‡', 'ðŸšˆ', 'ðŸš‰', 'ðŸšŒ', 'ðŸš', 'ðŸšŽ', 'ðŸš', 'ðŸš‘', 'ðŸš’', 'ðŸš“', 'ðŸš”',
            'ðŸš•', 'ðŸš–', 'ðŸš—', 'ðŸš˜', 'ðŸš™', 'ðŸšš', 'ðŸš›', 'ðŸšœ', 'ðŸŽï¸', 'ðŸï¸', 'ðŸ›µ', 'ðŸš²', 'ðŸ›´', 'ðŸ›¹', 'ðŸ›¼', 'ðŸš', 'ðŸ›£ï¸', 'ðŸ›¤ï¸', 'â›½', 'ðŸš¨',
            'ðŸš¥', 'ðŸš¦', 'ðŸš§', 'âš“', 'â›µ', 'ðŸ›¶', 'ðŸš¤', 'ðŸš¢', 'âœˆï¸', 'ðŸ›«', 'ðŸ›¬', 'ðŸª‚', ' seats', 'ðŸ›°ï¸', 'ðŸš€', 'ðŸ›¸', 'ðŸš', 'ðŸšŸ', 'ðŸš ', 'ðŸš¡'
        ];

        function renderEmojis() {
            emojiPickerContainer.innerHTML = '';
            emojis.forEach(emoji => {
                const span = document.createElement('span');
                span.textContent = emoji;
                span.addEventListener('click', () => {
                    messageInput.value += emoji; // Add emoji to input
                    messageInput.focus(); // Keep focus on input
                });
                emojiPickerContainer.appendChild(span);
            });
        }

        emojiToggleButton.addEventListener('click', () => {
            // Toggle visibility of the emoji picker
            const isHidden = emojiPickerContainer.style.display === 'none' || emojiPickerContainer.style.display === '';
            emojiPickerContainer.style.display = isHidden ? 'grid' : 'none';
        });

        // Hide emoji picker if clicked outside
        document.addEventListener('click', (event) => {
            if (!emojiPickerContainer.contains(event.target) && event.target !== emojiToggleButton && event.target !== messageInput) {
                emojiPickerContainer.style.display = 'none';
            }
        });


        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            renderEmojis();
            // Automatically scroll to the bottom when chatbox opens or new messages arrive
            messagesDisplay.scrollTop = messagesDisplay.scrollHeight;
        });

    </script>
</body>
</html>