<!DOCTYPE html>
<!-- saved from url=(0064)file:///Z:/FLM-PLATFORM/flm-admin/06-NEW%20Jellyfin%20admin.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLM TV Dashboard</title>
    <script src="./FLM TV Dashboard7_files/saved_resource"></script>
    <!-- Inter for general text, Exo 2 for hero title -->
    <link href="./FLM TV Dashboard7_files/css2" rel="stylesheet">
    <link rel="stylesheet" href="./FLM TV Dashboard7_files/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1rem;
        }
        .header {
            background-color: #2d3748; /* Darker header */
            padding: 1rem 0;
            border-bottom: 1px solid #4a5568;
        }
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }
        .nav-link:hover {
            background-color: #4a5568;
        }
        .hero-section {
            position: relative;
            height: 500px; /* Fixed height for hero */
            overflow: hidden;
            border-radius: 0.5rem;
            margin-top: 1rem;
            background-color: #2d3748;
        }
        .hero-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: flex-start; /* Align content to the left */
            background-size: cover;
            background-position: center;
            /* Adjusted gradient overlay for darker left side */
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.7) 50%, rgba(0, 0, 0, 0) 100%);
            background-blend-mode: multiply; /* Helps blend the gradient with the image */
        }
        .hero-slide.active {
            opacity: 1;
        }
        .hero-content {
            position: relative;
            z-index: 10;
            text-align: left; /* Align text to the left */
            color: white;
            padding: 2rem 5%; /* Adjusted padding for better left alignment */
            max-width: 50%; /* Reduced max-width for tighter text block */
            border-radius: 0.5rem;
        }
        .hero-content h2 {
            font-family: 'Exo 2', sans-serif; /* Unique font for main title */
            font-size: 3.5rem; /* Larger font size for main title */
            font-weight: 800; /* Heavier weight for impact */
            margin-bottom: 0.5rem; /* Reduced margin for closer subtitle */
            line-height: 1.1; /* Tighter line height */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); /* Subtle text shadow */
        }
        .hero-content .subtitle { /* New class for subtitle/short description */
            font-size: 1.5rem; /* Subtitle font size */
            font-weight: 500;
            margin-bottom: 1rem; /* Space before main description */
            line-height: 1.3;
        }
        .hero-content p {
            font-size: 1rem; /* Smaller font size for main description */
            margin-bottom: 1.5rem;
            line-height: 1.5;
            color: #cbd5e0; /* Slightly lighter color for body text */
        }
        .hero-buttons { /* Flex container for buttons */
            display: flex;
            gap: 1rem; /* Space between buttons */
            margin-top: 1.5rem;
        }
        .hero-buttons button {
            width: auto; /* Allow buttons to size based on content */
            padding: 0.75rem 1.5rem;
            border-radius: 0.25rem; /* Slightly less rounded */
            font-weight: bold;
            transition: background-color 0.2s, transform 0.1s;
            display: inline-flex; /* Align icon and text */
            align-items: center;
            gap: 0.5rem; /* Space between icon and text */
        }
        .hero-buttons button:hover {
            transform: scale(1.02); /* Slight scale on hover */
        }
        .hero-buttons button.primary-hero {
            background-color: white; /* White button for primary action */
            color: #1a202c; /* Dark text on white */
        }
        .hero-buttons button.primary-hero:hover {
            background-color: #e2e8f0;
        }
        .hero-buttons button.secondary-hero {
            background-color: rgba(107, 114, 128, 0.7); /* Greyish semi-transparent */
            color: white;
            border: 1px solid rgba(107, 114, 128, 0.7);
        }
        .hero-buttons button.secondary-hero:hover {
            background-color: rgba(107, 114, 128, 0.9);
        }

        .section-title {
            font-size: 1.875rem;
            font-weight: bold;
            margin-top: 2rem;
            margin-bottom: 1.5rem;
            color: #e2e8f0;
        }
        .carousel-wrapper { /* New wrapper for carousel and arrows */
            position: relative;
            margin-bottom: 2rem;
        }
        .carousel-container {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 1rem;
            scrollbar-width: none; /* Hide scrollbar for Firefox */
            -ms-overflow-style: none; /* Hide scrollbar for IE and Edge */
            scroll-behavior: smooth; /* Smooth scrolling for arrows */
        }
        .carousel-container::-webkit-scrollbar {
            display: none; /* Hide scrollbar for Chrome, Safari, Opera */
        }
        .carousel-item {
            flex: 0 0 auto;
            width: 200px; /* Fixed width for items */
            margin-right: 1rem;
            scroll-snap-align: start;
            background-color: #2d3748;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        .carousel-item:hover {
            transform: translateY(-5px);
        }
        .carousel-item img {
            width: 100%;
            height: 250px; /* Fixed height for images */
            object-fit: cover;
            border-radius: 0.5rem 0.5rem 0 0;
        }
        .carousel-item-info {
            padding: 1rem;
            color: #e2e8f0;
        }
        .carousel-item-info h3 {
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .carousel-item-info p {
            font-size: 0.875rem;
            color: #cbd5e0;
        }
        .carousel-arrow { /* Styling for navigation arrows */
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 0.75rem 0.5rem;
            cursor: pointer;
            z-index: 10;
            opacity: 0.7;
            transition: opacity 0.2s, background-color 0.2s;
            border-radius: 0.375rem;
        }
        .carousel-arrow:hover {
            opacity: 1;
            background-color: rgba(0, 0, 0, 0.8);
        }
        .carousel-arrow.left {
            left: 0;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        .carousel-arrow.right {
            right: 0;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        .footer {
            background-color: #2d3748;
            padding: 2rem 0;
            margin-top: 2rem;
            text-align: center;
            color: #cbd5e0;
            border-top: 1px solid #4a5568;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .modal.open {
            display: flex; /* Show when open */
            opacity: 1;
        }
        .modal-content {
            background-color: #2d3748;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            color: #e2e8f0;
        }
        .modal-header { /* New style for modal header */
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #4a5568;
            padding-bottom: 1rem;
        }
        .modal-header h2 {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            flex-grow: 1; /* Allows h2 to take up available space */
            margin-bottom: 0; /* Remove default margin */
        }
        .modal-header .close-btn { /* Style for close button within flex header */
            position: static; /* Override absolute positioning */
            font-size: 1.25rem; /* Slightly smaller for better fit */
            color: #cbd5e0; /* Lighter color */
            margin-left: 1rem; /* Space from title */
        }
        .modal-content label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .modal-content input[type="text"],
        .modal-content input[type="password"],
        .modal-content input[type="email"] {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1.5rem;
            border-radius: 0.375rem;
            border: 1px solid #4a5568;
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .modal-content button {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        .modal-content button.primary {
            background-color: #4299e1;
            color: white;
        }
        .modal-content button.primary:hover {
            background-color: #3182ce;
        }
        .modal-content button.secondary {
            background-color: #4a5568;
            color: white;
            margin-top: 0.75rem;
        }
        .modal-content button.secondary:hover {
            background-color: #2d3748;
        }
        .error-message {
            color: #fc8181; /* Red color for errors */
            margin-top: -1rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        .settings-panel {
            position: fixed;
            top: 0;
            right: -350px; /* Hidden by default */
            width: 350px;
            height: 100%;
            background-color: #2d3748;
            box-shadow: -4px 0 10px rgba(0, 0, 0, 0.3);
            transition: right 0.3s ease-in-out;
            z-index: 1000;
            padding: 1.5rem;
            color: #e2e8f0;
            overflow-y: auto;
        }
        .settings-panel.open {
            right: 0;
        }
        /* Settings panel header needs similar flex treatment */
        .settings-panel .modal-header { /* Re-using modal-header style */
            padding-left: 0; /* Adjust padding for panel */
            padding-right: 0; /* Adjust padding for panel */
        }
        .settings-panel label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .settings-panel input[type="text"],
        .settings-panel input[type="password"],
        .settings-panel input[type="email"] {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1.5rem;
            border-radius: 0.375rem;
            border: 1px solid #4a5568;
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .settings-panel button {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: background-color 0.2s;
            margin-top: 1rem;
        }
        .settings-panel button.primary {
            background-color: #4299e1;
            color: white;
        }
        .settings-panel button.primary:hover {
            background-color: #3182ce;
        }
        .settings-panel button.secondary {
            background-color: #4a5568;
            color: white;
        }
        .settings-panel button.secondary:hover {
            background-color: #2d3748;
        }
        /* Close button in settings panel is now handled by .modal-header .close-btn */
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.mb-4{margin-bottom:1rem}.mt-1{margin-top:0.25rem}.mt-4{margin-top:1rem}.block{display:block}.flex{display:flex}.w-full{width:100%}.items-center{align-items:center}.justify-between{justify-content:space-between}.space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.font-bold{font-weight:700}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-red-400{--tw-text-opacity:1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}</style></head>
<body>
    <div class="header">
        <div class="container flex justify-between items-center">
            <div class="text-2xl font-bold text-white">FLM TV Dashboard</div>
            <nav class="space-x-4 flex items-center">
                <a href="file:///Z:/FLM-PLATFORM/flm-admin/06-NEW%20Jellyfin%20admin.html#" class="nav-link text-white">Home</a>
                <a href="file:///Z:/FLM-PLATFORM/flm-admin/06-NEW%20Jellyfin%20admin.html#" class="nav-link text-white">Movies</a>
                <a href="file:///Z:/FLM-PLATFORM/flm-admin/06-NEW%20Jellyfin%20admin.html#" class="nav-link text-white">TV Shows</a>
                <a href="file:///Z:/FLM-PLATFORM/flm-admin/06-NEW%20Jellyfin%20admin.html#" class="nav-link text-white">Music</a>
                <button id="settingsButton" class="nav-link text-white" disabled="">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button id="authButton" class="nav-link text-white fa-sign-out-alt">Sign Out</button>
            </nav>
        </div>
    </div>

    <main class="container">
        <!-- Hero Section -->
        <section class="hero-section" id="heroSection"><div class="hero-slide" style="background-image: linear-gradient(to right, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.7) 50%, rgba(0, 0, 0, 0) 100%), url(&quot;https://image.tmdb.org/t/p/w1280/6WqqEjiycNvDLjbEClM1zCwIbDD.jpg&quot;);">
                            <div class="hero-content">
                                <!-- Removed "NETFLIX ORIGINAL" as requested -->
                                <h2>28 Years Later</h2>
                                <p class="subtitle">Uncover ancient secrets hidden beneath the waves.</p>
                                <p>Twenty-eight years since the rage virus escaped a biological weapons laboratory, now, still in a ruthlessly enforced quarantine, some have found ways to exist amidst the infected. One such group lives on a small island connected to the mainland by a single, heavily-defended causeway. When one member departs on a mission into the dark heart of the mainland, he discovers secrets, wonders, and horrors that have mutated not only the infected but other survivors as well.</p>
                                <div class="hero-buttons">
                                    <button class="primary-hero">
                                        <i class="fas fa-play"></i> Trailer
                                    </button>
                                    <button class="secondary-hero">
                                        <i class="fas fa-plus"></i> My List
                                    </button>
                                </div>
                            </div>
                        </div><div class="hero-slide" style="background-image: linear-gradient(to right, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.7) 50%, rgba(0, 0, 0, 0) 100%), url(&quot;https://image.tmdb.org/t/p/w1280/s94NjfKkcSczZ1FembwmQZwsuwY.jpg&quot;);">
                            <div class="hero-content">
                                <!-- Removed "NETFLIX ORIGINAL" as requested -->
                                <h2>The Fantastic 4: First Steps</h2>
                                <p class="subtitle">Uncover ancient secrets hidden beneath the waves.</p>
                                <p>Against the vibrant backdrop of a 1960s-inspired, retro-futuristic world, Marvel's First Family is forced to balance their roles as heroes with the strength of their family bond, while defending Earth from a ravenous space god called Galactus and his enigmatic Herald, Silver Surfer.</p>
                                <div class="hero-buttons">
                                    <button class="primary-hero">
                                        <i class="fas fa-play"></i> Trailer
                                    </button>
                                    <button class="secondary-hero">
                                        <i class="fas fa-plus"></i> My List
                                    </button>
                                </div>
                            </div>
                        </div><div class="hero-slide" style="background-image: linear-gradient(to right, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.7) 50%, rgba(0, 0, 0, 0) 100%), url(&quot;https://image.tmdb.org/t/p/w1280/x5dVPttNDZaVRTvbk7pYrtGZoZN.jpg&quot;);">
                            <div class="hero-content">
                                <!-- Removed "NETFLIX ORIGINAL" as requested -->
                                <h2>Happy Gilmore 2</h2>
                                <p class="subtitle">Uncover ancient secrets hidden beneath the waves.</p>
                                <p>Happy Gilmore isn't done with golf — not by a long shot. Since his retirement after his first Tour Championship win, Gilmore returns to finance his daughter's ballet classes.</p>
                                <div class="hero-buttons">
                                    <button class="primary-hero">
                                        <i class="fas fa-play"></i> Trailer
                                    </button>
                                    <button class="secondary-hero">
                                        <i class="fas fa-plus"></i> My List
                                    </button>
                                </div>
                            </div>
                        </div><div class="hero-slide active" style="background-image: linear-gradient(to right, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.7) 50%, rgba(0, 0, 0, 0) 100%), url(&quot;https://image.tmdb.org/t/p/w1280/eU7IfdWq8KQy0oNd4kKXS0QUR08.jpg&quot;);">
                            <div class="hero-content">
                                <!-- Removed "NETFLIX ORIGINAL" as requested -->
                                <h2>Superman</h2>
                                <p class="subtitle">Uncover ancient secrets hidden beneath the waves.</p>
                                <p>Superman, a journalist in Metropolis, embarks on a journey to reconcile his Kryptonian heritage with his human upbringing as Clark Kent.</p>
                                <div class="hero-buttons">
                                    <button class="primary-hero">
                                        <i class="fas fa-play"></i> Trailer
                                    </button>
                                    <button class="secondary-hero">
                                        <i class="fas fa-plus"></i> My List
                                    </button>
                                </div>
                            </div>
                        </div><div class="hero-slide" style="background-image: linear-gradient(to right, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.7) 50%, rgba(0, 0, 0, 0) 100%), url(&quot;https://image.tmdb.org/t/p/w1280/lqwwGkwJHtz9QgKtz4zeY19YgDg.jpg&quot;);">
                            <div class="hero-content">
                                <!-- Removed "NETFLIX ORIGINAL" as requested -->
                                <h2>Materialists</h2>
                                <p class="subtitle">Uncover ancient secrets hidden beneath the waves.</p>
                                <p>A young, ambitious New York City matchmaker finds herself torn between the perfect match and her imperfect ex.</p>
                                <div class="hero-buttons">
                                    <button class="primary-hero">
                                        <i class="fas fa-play"></i> Trailer
                                    </button>
                                    <button class="secondary-hero">
                                        <i class="fas fa-plus"></i> My List
                                    </button>
                                </div>
                            </div>
                        </div></section>

        <!-- Latest Releases Section -->
        <section>
            <h2 class="section-title">Latest Releases</h2>
            <div class="carousel-wrapper">
                <button class="carousel-arrow left" id="latestReleasesLeftArrow"><i class="fas fa-chevron-left"></i></button>
                <div class="carousel-container" id="latestReleasesCarousel"><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/53dsJ3oEnBhTBVMigWJ9tkA5bzJ.jpg" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="How to Train Your Dragon">
                            <div class="carousel-item-info">
                                <h3>How to Train Your Dragon</h3>
                                <p>2025</p>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/aFRDH3P7TX61FVGpaLhKr6QiOC1.jpg" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Demon Slayer: Kimetsu no Yaiba Infinity Castle">
                            <div class="carousel-item-info">
                                <h3>Demon Slayer: Kimetsu no Yaiba Infinity Castle</h3>
                                <p>2025</p>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/oekamLQrwlJjRNmfaBE4llIvkir.jpg" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="M3GAN 2.0">
                            <div class="carousel-item-info">
                                <h3>M3GAN 2.0</h3>
                                <p>2025</p>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/ynT06XivgBDkg7AtbDbX1dJeBGY.jpg" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Happy Gilmore 2">
                            <div class="carousel-item-info">
                                <h3>Happy Gilmore 2</h3>
                                <p>2025</p>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/x26MtUlwtWD26d0G0FXcppxCJio.jpg" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="The Fantastic 4: First Steps">
                            <div class="carousel-item-info">
                                <h3>The Fantastic 4: First Steps</h3>
                                <p>2025</p>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/3mExdWLSxAiUCb4NMcYmxSkO7n4.jpg" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Bride Hard">
                            <div class="carousel-item-info">
                                <h3>Bride Hard</h3>
                                <p>2025</p>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/ombsmhYUqR4qqOLOxAyr5V8hbyv.jpg" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Superman">
                            <div class="carousel-item-info">
                                <h3>Superman</h3>
                                <p>2025</p>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/cQN9rZj06rXMVkk76UF1DfBAico.jpg" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Ice Road: Vengeance">
                            <div class="carousel-item-info">
                                <h3>Ice Road: Vengeance</h3>
                                <p>2025</p>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/AEgggzRr1vZCLY86MAp93li43z.jpg" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Karate Kid: Legends">
                            <div class="carousel-item-info">
                                <h3>Karate Kid: Legends</h3>
                                <p>2025</p>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/1RICxzeoNCAO5NpcRMIgg1XT6fm.jpg" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Jurassic World Rebirth">
                            <div class="carousel-item-info">
                                <h3>Jurassic World Rebirth</h3>
                                <p>2025</p>
                            </div>
                        </div></div>
                <button class="carousel-arrow right" id="latestReleasesRightArrow"><i class="fas fa-chevron-right"></i></button>
            </div>
        </section>

        <!-- Categories Section -->
        <section>
            <h2 class="section-title">Categories</h2>
            <div class="carousel-wrapper">
                <button class="carousel-arrow left" id="categoriesLeftArrow"><i class="fas fa-chevron-left"></i></button>
                <div class="carousel-container" id="categoriesCarousel"><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Action">
                            <div class="carousel-item-info">
                                <h3>Action</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(1)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Adventure">
                            <div class="carousel-item-info">
                                <h3>Adventure</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(2)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Animation">
                            <div class="carousel-item-info">
                                <h3>Animation</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(3)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Comedy">
                            <div class="carousel-item-info">
                                <h3>Comedy</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(4)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Crime">
                            <div class="carousel-item-info">
                                <h3>Crime</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(5)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Documentary">
                            <div class="carousel-item-info">
                                <h3>Documentary</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(6)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Drama">
                            <div class="carousel-item-info">
                                <h3>Drama</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(7)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Family">
                            <div class="carousel-item-info">
                                <h3>Family</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(8)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Fantasy">
                            <div class="carousel-item-info">
                                <h3>Fantasy</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(9)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="History">
                            <div class="carousel-item-info">
                                <h3>History</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(10)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Horror">
                            <div class="carousel-item-info">
                                <h3>Horror</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(11)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Music">
                            <div class="carousel-item-info">
                                <h3>Music</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(12)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Mystery">
                            <div class="carousel-item-info">
                                <h3>Mystery</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(13)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Romance">
                            <div class="carousel-item-info">
                                <h3>Romance</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(14)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Science Fiction">
                            <div class="carousel-item-info">
                                <h3>Science Fiction</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(15)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="TV Movie">
                            <div class="carousel-item-info">
                                <h3>TV Movie</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(16)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Thriller">
                            <div class="carousel-item-info">
                                <h3>Thriller</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(17)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="War">
                            <div class="carousel-item-info">
                                <h3>War</h3>
                            </div>
                        </div><div class="carousel-item">
                            <img src="./FLM TV Dashboard7_files/e2e8f0(18)" onerror="this.onerror=null;this.src=&#39;https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image&#39;;" alt="Western">
                            <div class="carousel-item-info">
                                <h3>Western</h3>
                            </div>
                        </div></div>
                <button class="carousel-arrow right" id="categoriesRightArrow"><i class="fas fa-chevron-right"></i></button>
            </div>
        </section>

        <!-- Live TV Channels Section -->
        <section>
            <h2 class="section-title">Live TV Channels</h2>
            <div class="carousel-wrapper">
                <button class="carousel-arrow left" id="liveTvLeftArrow"><i class="fas fa-chevron-left"></i></button>
                <div class="carousel-container" id="liveTvCarousel"><p class="text-red-400 text-center w-full">Error fetching Jellyfin data: Failed to fetch. This often means the Jellyfin server URL is incorrect, the server is not running, or there's a **CORS (Cross-Origin Resource Sharing)** issue. Please ensure your Jellyfin server is configured to allow requests from this origin.</p></div>
                <button class="carousel-arrow right" id="liveTvRightArrow"><i class="fas fa-chevron-right"></i></button>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>© 2024 FLM TV Dashboard. All rights reserved.</p>
    </footer>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="settings-panel">
        <div class="modal-header">
            <h2>Settings</h2>
            <button class="close-btn" id="closeSettingsPanelBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="mb-4">
            <label for="jellyfinUrlInput" class="block text-sm">Jellyfin Server URL:</label>
            <input type="text" id="jellyfinUrlInput" placeholder="e.g., http://localhost:8096" class="mt-1" disabled="">
        </div>
        <div class="mb-4">
            <label for="jellyfinApiKeyInput" class="block text-sm">Jellyfin API Key:</label>
            <input type="password" id="jellyfinApiKeyInput" placeholder="Your API Key" class="mt-1" disabled="">
        </div>
        <div class="mb-4">
            <label for="jellyfinUserIdInput" class="block text-sm">Jellyfin User ID (Optional):</label>
            <input type="text" id="jellyfinUserIdInput" placeholder="Your User ID (optional)" class="mt-1" disabled="">
        </div>
        <div class="mb-4">
            <label for="tmdbApiKeyInput" class="block text-sm">TMDb API Key (Optional):</label>
            <input type="password" id="tmdbApiKeyInput" placeholder="Your TMDb API Key" class="mt-1" disabled="">
        </div>
        <button id="saveSettingsButton" class="primary" disabled="">Save Settings</button>
        <button id="clearSettingsButton" class="secondary" disabled="">Clear Settings</button>
    </div>

    <!-- Message Box for alerts -->
    <div id="messageBox" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="messageBoxTitle">Sign In Success</h2>
                <button class="close-btn" id="closeMessageBoxBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <p id="messageBoxMessage">You have been successfully signed in!</p>
            <button class="primary" id="messageBoxOkBtn">OK</button>
        </div>
    </div>

    <!-- Auth Box for Sign In/Sign Up -->
    <div id="authBox" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="authBoxTitle">Sign In</h2>
                <button class="close-btn" id="closeAuthBoxBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <label for="authEmailInput" class="block text-sm">Email:</label>
                <input type="email" id="authEmailInput" placeholder="your@email.com" class="mt-1">
            </div>
            <div class="mb-4">
                <label for="authPasswordInput" class="block text-sm">Password:</label>
                <input type="password" id="authPasswordInput" placeholder="Password" class="mt-1">
            </div>
            <button id="signInButton" class="primary">Sign In</button>
            <button id="signUpButton" class="secondary">Sign Up</button>
            <p id="authErrorMessage" class="error-message mt-4" style="display:none;"></p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, query, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase variables
        let app;
        let db;
        let auth;
        let userId;
        let isAuthReady = false;
        let isAdmin = false; // Track admin status

        // IMPORTANT: Ensure your firebaseConfig here is your FLM App's ACTUAL Firebase configuration!
        // You MUST replace the placeholder values below with the actual configuration for your Firebase project.
        // You can find this in your Firebase project console: Project settings (gear icon) -> Your apps -> Web app.
        const firebaseConfig = {
            apiKey: "AIzaSyDK4UzlMVUJWDKh0ynnDMpyhA7iUnsRUCc",
            authDomain: "flmchat-16c19.firebaseapp.com",
            databaseURL: "https://flmchat-16c19-default-rtdb.firebaseio.com",
            projectId: "flmchat-16c19",
            storageBucket: "flmchat-16c19.firebasestorage.app",
            messagingSenderId: "855266929572",
            appId: "1:855266929572:web:ef3200ff38ad90a8d86f31",
            measurementId: "G-48HJZKBXKN"
        };

        // The __app_id variable is specific to the Canvas environment. When integrating into your own app,
        // you might replace 'default-app-id' with a static identifier for your app, or remove it if not needed for Firestore paths.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'; // Retain appId for Firestore path consistency

        // TMDb API Constants
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        const TMDB_IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w500'; // For posters and backdrops
        const TMDB_BACKDROP_BASE_URL = 'https://image.tmdb.org/t/p/w1280'; // For hero section backdrops


        /**
         * Initializes Firebase and sets up authentication.
         * This function should be called once when the app starts.
         */
        async function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Firebase Auth State Changed: User is signed in. UID:", userId);

                        if (user.isAnonymous) {
                            console.log("Firebase Auth State Changed: User is anonymous.");
                            isAdmin = false;
                            document.getElementById('authButton').textContent = 'Sign In';
                            document.getElementById('authButton').classList.remove('fa-sign-out-alt');
                            document.getElementById('authButton').classList.add('fa-user');
                            document.getElementById('settingsButton').disabled = true; // Disable settings button for anonymous
                            document.getElementById('saveSettingsButton').disabled = true;
                            document.getElementById('clearSettingsButton').disabled = true;
                            document.getElementById('jellyfinUrlInput').disabled = true;
                            document.getElementById('jellyfinApiKeyInput').disabled = true;
                            document.getElementById('jellyfinUserIdInput').disabled = true;
                            document.getElementById('tmdbApiKeyInput').disabled = true;
                            applyPublicContent();
                        } else {
                            console.log("Firebase Auth State Changed: User is authenticated (not anonymous).");
                            document.getElementById('authButton').textContent = 'Sign Out';
                            document.getElementById('authButton').classList.remove('fa-user');
                            document.getElementById('authButton').classList.add('fa-sign-out-alt');

                            // Force refresh to get latest claims (important if admin claim was just set)
                            const idTokenResult = await user.getIdTokenResult(true);
                            if (idTokenResult.claims.admin) {
                                console.log("User has admin claims. Enabling settings.");
                                isAdmin = true;
                                document.getElementById('settingsButton').disabled = false; // Enable settings button for admin
                                document.getElementById('saveSettingsButton').disabled = false; // Enable save for admin
                                document.getElementById('clearSettingsButton').disabled = false; // Enable clear for admin
                                document.getElementById('jellyfinUrlInput').disabled = false;
                                document.getElementById('jellyfinApiKeyInput').disabled = false;
                                document.getElementById('jellyfinUserIdInput').disabled = false;
                                document.getElementById('tmdbApiKeyInput').disabled = false;
                                await applyAdminSettings();
                            } else {
                                console.log("User does not have admin claims. Settings panel disabled.");
                                isAdmin = false;
                                document.getElementById('settingsButton').disabled = true; // Disable settings button for non-admin
                                document.getElementById('saveSettingsButton').disabled = true; // Disable save for non-admin
                                document.getElementById('clearSettingsButton').disabled = true; // Disable clear for non-admin
                                document.getElementById('jellyfinUrlInput').disabled = true;
                                document.getElementById('jellyfinApiKeyInput').disabled = true;
                                document.getElementById('jellyfinUserIdInput').disabled = true;
                                document.getElementById('tmdbApiKeyInput').disabled = true;
                                applyPublicContent();
                            }
                        }
                    } else {
                        // No user signed in (initial load or after explicit sign out)
                        userId = null;
                        isAdmin = false;
                        document.getElementById('authButton').textContent = 'Sign In';
                        document.getElementById('authButton').classList.remove('fa-sign-out-alt');
                        document.getElementById('authButton').classList.add('fa-user');
                        document.getElementById('settingsButton').disabled = true; // Always disabled if no user
                        document.getElementById('saveSettingsButton').disabled = true;
                        document.getElementById('clearSettingsButton').disabled = true;
                        document.getElementById('jellyfinUrlInput').disabled = true;
                        document.getElementById('jellyfinApiKeyInput').disabled = true;
                        document.getElementById('jellyfinUserIdInput').disabled = true;
                        document.getElementById('tmdbApiKeyInput').disabled = true;
                        console.log("Firebase Auth State Changed: No user signed in. Attempting anonymous sign-in.");
                        // Attempt anonymous sign-in if no user is present
                        try {
                            await signInAnonymously(auth);
                            // onAuthStateChanged will be triggered again with the anonymous user
                        } catch (anonError) {
                            console.error("Error signing in anonymously:", anonError);
                            showMessageBox('Firebase Authentication Error', `Failed to sign in anonymously: ${anonError.message}. Public content may not load.`);
                        }
                    }
                    isAuthReady = true;
                    console.log(`Firebase Initialized: App ID: ${appId}, Current User ID for Firestore: ${userId}`);
                });

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                showMessageBox('Firebase Initialization Error', `Failed to initialize Firebase: ${error.message}. Please check your Firebase configuration.`);
            }
        }

        /**
         * Displays a custom message box.
         * @param {string} title - The title of the message box.
         * @param {string} message - The message to display.
         */
        function showMessageBox(title, message) {
            const messageBox = document.getElementById('messageBox');
            document.getElementById('messageBoxTitle').textContent = title;
            document.getElementById('messageBoxMessage').textContent = message;
            messageBox.style.display = 'flex';
            setTimeout(() => {
                messageBox.classList.add('open');
            }, 10);
        }

        /**
         * Closes the custom message box.
         */
        function closeMessageBox() {
            const messageBox = document.getElementById('messageBox');
            messageBox.classList.remove('open');
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 300);
        }

        /**
         * Shows a loading spinner for a given element.
         * @param {string} elementId - The ID of the element whose spinner should be shown.
         */
        function showLoadingSpinner(elementId) {
            const spinner = document.getElementById(elementId);
            if (spinner) {
                spinner.classList.add('active');
            }
        }

        /**
         * Hides a loading spinner for a given element.
         * @param {string} elementId - The ID of the element whose spinner should be hidden.
         */
        function hideLoadingSpinner(elementId) {
            const spinner = document.getElementById(elementId);
            if (spinner) {
                spinner.classList.remove('active');
            }
        }

        /**
         * Fetches data from the Jellyfin API.
         * @param {string} endpoint - The API endpoint (e.g., 'Users').
         * @param {string} serverUrl - The base URL of the Jellyfin server.
         * @param {string} apiKey - The Jellyfin API key.
         * @param {string} [userIdParam=''] - Optional user ID for specific user data.
         * @returns {Promise<Object>} The JSON response from the API.
         */
        async function fetchJellyfinData(endpoint, serverUrl, apiKey, userIdParam = '') {
            console.log(`Attempting to fetch from Jellyfin: ${serverUrl}/rest/${endpoint}`);
            console.log(`Using API Key: ${apiKey ? 'Provided' : 'Not Provided'}`);
            console.log(`Using User ID: ${userIdParam ? userIdParam : 'Not Provided'}`);

            if (!serverUrl || !apiKey) {
                throw new Error("Jellyfin Server URL and API Key are required.");
            }

            // Ensure the URL ends with a slash for consistent path joining
            const baseUrl = serverUrl.endsWith('/') ? serverUrl : `${serverUrl}/`;
            const url = `${baseUrl}rest/${endpoint}`;

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-MediaBrowser-Token': apiKey,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status}, Message: ${errorText}`);
                }

                // Check if the response is valid JSON before parsing
                const contentType = response.headers.get("content-type");
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    return await response.json();
                } else {
                    // If not JSON, it's likely an HTML page (e.g., a login page or error page)
                    throw new Error(`Expected JSON response, but received content type: ${contentType}. This often indicates an incorrect Jellyfin server URL or API Key, or a CORS issue. Full response: ${await response.text().then(t => t.substring(0, 200) + '...')}`);
                }

            } catch (error) {
                console.error(`Error fetching Jellyfin data from ${url}:`, error);
                let errorMessage = `Error fetching Jellyfin data: ${error.message}.`;
                if (error instanceof TypeError && error.message === 'Failed to fetch') {
                    errorMessage += ` This often means the Jellyfin server URL is incorrect, the server is not running, or there's a **CORS (Cross-Origin Resource Sharing)** issue. Please ensure your Jellyfin server is configured to allow requests from this origin.`;
                }
                throw new Error(errorMessage);
            }
        }

        /**
         * Fetches data from the TMDb API.
         * @param {string} endpoint - The API endpoint (e.g., 'trending/movie/week').
         * @param {string} tmdbApiKey - The TMDb API key.
         * @param {Object} [params={}] - Optional query parameters.
         * @returns {Promise<Object>} The JSON response from the API.
         */
        async function fetchTMDbData(endpoint, tmdbApiKey, params = {}) {
            console.log(`Attempting to fetch from TMDb: ${TMDB_BASE_URL}/${endpoint}`);
            console.log(`Using TMDb API Key: ${tmdbApiKey ? 'Provided' : 'Not Provided'}`);

            if (!tmdbApiKey) {
                throw new Error("TMDb API Key is required for TMDb requests.");
            }

            const url = new URL(`${TMDB_BASE_URL}/${endpoint}`);
            url.searchParams.append('api_key', tmdbApiKey);
            for (const key in params) {
                url.searchParams.append(key, params[key]);
            }

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status}, Message: ${errorText}`);
                }
                return await response.json();
            } catch (error) {
                console.error(`Error fetching TMDb data from ${url}:`, error);
                throw new Error(`Error fetching TMDb data: ${error.message}`);
            }
        }

        /**
         * Fetches and sets up the hero slideshow with recent movies/trending content.
         */
        async function fetchAndSetupHeroSlideshow() {
            showLoadingSpinner('heroLoadingSpinner');
            const heroSection = document.getElementById('heroSection');
            const jellyfinServerUrl = localStorage.getItem('jellyfinServerUrl');
            const jellyfinApiKey = localStorage.getItem('jellyfinApiKey');
            const jellyfinUserId = localStorage.getItem('jellyfinUserId');
            const tmdbApiKey = localStorage.getItem('tmdbApiKey');

            heroSection.innerHTML = ''; // Clear existing content

            try {
                let items = [];
                let source = 'unknown';

                if (tmdbApiKey) {
                    // Try fetching from TMDb
                    const tmdbData = await fetchTMDbData('trending/movie/week', tmdbApiKey);
                    if (tmdbData && tmdbData.results && tmdbData.results.length > 0) {
                        items = tmdbData.results.slice(0, 5).map(item => ({
                            Name: item.title || item.name,
                            Overview: item.overview,
                            Id: item.id,
                            BackdropImageTags: [item.backdrop_path], // Store path as tag for consistency
                            ProductionYear: (item.release_date || item.first_air_date) ? new Date(item.release_date || item.first_air_date).getFullYear() : '',
                            Tagline: item.tagline || 'Uncover ancient secrets hidden beneath the waves.' // Example tagline
                        }));
                        source = 'TMDb';
                    }
                } else if (jellyfinServerUrl && jellyfinApiKey) {
                    // Fallback to Jellyfin if TMDb not configured or no results
                    const jellyfinData = await fetchJellyfinData(
                        `Users/${jellyfinUserId}/Items?Recursive=true&IncludeItemTypes=Movie&SortBy=DateCreated&SortOrder=Descending&Limit=5`,
                        jellyfinServerUrl,
                        jellyfinApiKey,
                        jellyfinUserId
                    );
                    if (jellyfinData && jellyfinData.Items && jellyfinData.Items.length > 0) {
                        items = jellyfinData.Items;
                        source = 'Jellyfin';
                    }
                }

                if (items.length > 0) {
                    let currentSlide = 0;
                    items.forEach((item, index) => {
                        let imageUrl;
                        if (source === 'TMDb' && item.BackdropImageTags && item.BackdropImageTags[0]) {
                            imageUrl = `${TMDB_BACKDROP_BASE_URL}${item.BackdropImageTags[0]}`;
                        } else if (source === 'Jellyfin' && item.BackdropImageTags && item.BackdropImageTags[0]) {
                            imageUrl = `${jellyfinServerUrl}/Items/${item.Id}/Images/Backdrop?tag=${item.BackdropImageTags[0]}&quality=90&maxWidth=1280&fillWidth=1280&fillHeight=500`;
                        } else {
                            imageUrl = 'https://placehold.co/1280x500/1a202c/e2e8f0?text=No+Image'; // Fallback
                        }

                        const slide = document.createElement('div');
                        slide.className = `hero-slide ${index === 0 ? 'active' : ''}`;
                        // The gradient is applied first, then the image URL
                        slide.style.backgroundImage = `linear-gradient(to right, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.7) 50%, rgba(0, 0, 0, 0) 100%), url('${imageUrl}')`;
                        slide.innerHTML = `
                            <div class="hero-content">
                                <!-- Removed "NETFLIX ORIGINAL" as requested -->
                                <h2>${item.Name}</h2>
                                <p class="subtitle">${item.Tagline || 'A captivating story unfolds.'}</p>
                                <p>${item.Overview || 'No description available.'}</p>
                                <div class="hero-buttons">
                                    <button class="primary-hero">
                                        <i class="fas fa-play"></i> Trailer
                                    </button>
                                    <button class="secondary-hero">
                                        <i class="fas fa-plus"></i> My List
                                    </button>
                                </div>
                            </div>
                        `;
                        heroSection.appendChild(slide);
                    });

                    const slides = heroSection.querySelectorAll('.hero-slide');
                    setInterval(() => {
                        slides[currentSlide].classList.remove('active');
                        currentSlide = (currentSlide + 1) % slides.length;
                        slides[currentSlide].classList.add('active');
                    }, 5000); // Change slide every 5 seconds
                } else {
                    heroSection.innerHTML = `<div class="hero-content">
                        <h2 class="text-xl font-semibold">No Content Found</h2>
                        <p class="text-gray-400">Please configure Jellyfin or TMDb settings.</p>
                        <button id="heroOpenSettingsBtn" class="mt-4">Open Settings</button>
                    </div>`;
                    document.getElementById('heroOpenSettingsBtn').addEventListener('click', toggleLumaPanel);
                }
            } catch (error) {
                console.error("Error fetching hero slideshow data:", error);
                heroSection.innerHTML = `<div class="hero-content">
                    <h2 class="text-xl font-semibold">Failed to Load Hero</h2>
                    <p class="text-red-400">${error.message}</p>
                    <button id="heroErrorOpenSettingsBtn" class="mt-4">Open Settings</button>
                </div>`;
                document.getElementById('heroErrorOpenSettingsBtn').addEventListener('click', toggleLumaPanel);
            } finally {
                hideLoadingSpinner('heroLoadingSpinner');
            }
        }

        /**
         * Fetches and displays latest releases (movies or episodes).
         */
        async function fetchAndDisplayLatestReleases() {
            showLoadingSpinner('latestReleasesLoadingSpinner');
            const carousel = document.getElementById('latestReleasesCarousel');
            carousel.innerHTML = '<div class="loading-spinner active" id="latestReleasesLoadingSpinner"></div>'; // Reset and show spinner
            const jellyfinServerUrl = localStorage.getItem('jellyfinServerUrl');
            const jellyfinApiKey = localStorage.getItem('jellyfinApiKey');
            const jellyfinUserId = localStorage.getItem('jellyfinUserId');
            const tmdbApiKey = localStorage.getItem('tmdbApiKey');

            try {
                let items = [];
                let source = 'unknown';

                if (tmdbApiKey) {
                    const tmdbData = await fetchTMDbData('movie/now_playing', tmdbApiKey);
                    if (tmdbData && tmdbData.results && tmdbData.results.length > 0) {
                        items = tmdbData.results.slice(0, 10).map(item => ({
                            Name: item.title,
                            Id: item.id,
                            ImageTags: { Primary: item.poster_path },
                            ProductionYear: item.release_date ? new Date(item.release_date).getFullYear() : ''
                        }));
                        source = 'TMDb';
                    }
                } else if (jellyfinServerUrl && jellyfinApiKey) {
                    const jellyfinData = await fetchJellyfinData(
                        `Users/${jellyfinUserId}/Items?Recursive=true&SortBy=DateCreated&SortOrder=Descending&Limit=10`,
                        jellyfinServerUrl,
                        jellyfinApiKey,
                        jellyfinUserId
                    );
                    if (jellyfinData && jellyfinData.Items && jellyfinData.Items.length > 0) {
                        items = jellyfinData.Items;
                        source = 'Jellyfin';
                    }
                }

                carousel.innerHTML = ''; // Clear spinner and previous items
                if (items.length > 0) {
                    items.forEach(item => {
                        let imageUrl;
                        if (source === 'TMDb' && item.ImageTags.Primary) {
                            imageUrl = `${TMDB_IMAGE_BASE_URL}${item.ImageTags.Primary}`;
                        } else if (source === 'Jellyfin' && item.ImageTags.Primary) {
                            imageUrl = `${jellyfinServerUrl}/Items/${item.Id}/Images/Primary?tag=${item.ImageTags.Primary}&quality=90&maxWidth=200&maxHeight=250`;
                        } else {
                            imageUrl = 'https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image';
                        }

                        const itemElement = document.createElement('div');
                        itemElement.className = 'carousel-item';
                        itemElement.innerHTML = `
                            <img src="${imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image';" alt="${item.Name}">
                            <div class="carousel-item-info">
                                <h3>${item.Name}</h3>
                                <p>${item.ProductionYear || ''}</p>
                            </div>
                        `;
                        carousel.appendChild(itemElement);
                    });
                } else {
                    carousel.innerHTML = `<p class="text-gray-400 text-center w-full">No latest releases found. Please configure Jellyfin or TMDb settings.</p>`;
                }
            } catch (error) {
                console.error("Error fetching latest releases:", error);
                carousel.innerHTML = `<p class="text-red-400 text-center w-full">${error.message}</p>`;
            } finally {
                hideLoadingSpinner('latestReleasesLoadingSpinner');
            }
        }

        /**
         * Fetches and displays categories (genres).
         */
        async function fetchAndDisplayCategories() {
            showLoadingSpinner('categoriesLoadingSpinner');
            const carousel = document.getElementById('categoriesCarousel');
            carousel.innerHTML = '<div class="loading-spinner active" id="categoriesLoadingSpinner"></div>'; // Reset and show spinner
            const jellyfinServerUrl = localStorage.getItem('jellyfinServerUrl');
            const jellyfinApiKey = localStorage.getItem('jellyfinApiKey');
            const jellyfinUserId = localStorage.getItem('jellyfinUserId');
            const tmdbApiKey = localStorage.getItem('tmdbApiKey');

            try {
                let items = [];
                let source = 'unknown';

                if (tmdbApiKey) {
                    const tmdbData = await fetchTMDbData('genre/movie/list', tmdbApiKey);
                    if (tmdbData && tmdbData.genres && tmdbData.genres.length > 0) {
                        // For categories, TMDb gives genre names. We'll use a placeholder image for now.
                        // Removed .slice(0, 10) to display all available categories
                        items = tmdbData.genres.map(genre => ({
                            Name: genre.name,
                            Id: genre.id,
                            ImageTags: { Primary: null } // No specific image from TMDb genre list
                        }));
                        source = 'TMDb';
                    }
                } else if (jellyfinServerUrl && jellyfinApiKey) {
                    const jellyfinData = await fetchJellyfinData(
                        `Genres?UserId=${jellyfinUserId}`, // Removed Limit to fetch all genres from Jellyfin
                        jellyfinServerUrl,
                        jellyfinApiKey,
                        jellyfinUserId
                    );
                    if (jellyfinData && jellyfinData.Items && jellyfinData.Items.length > 0) {
                        items = jellyfinData.Items;
                        source = 'Jellyfin';
                    }
                }

                carousel.innerHTML = ''; // Clear spinner and previous items
                if (items.length > 0) {
                    items.forEach(item => {
                        let imageUrl;
                        if (source === 'Jellyfin' && item.ImageTags.Primary) {
                            imageUrl = `${jellyfinServerUrl}/Items/${item.Id}/Images/Primary?tag=${item.ImageTags.Primary}&quality=90&maxWidth=200&maxHeight=250`;
                        } else {
                            // For TMDb genres or if Jellyfin has no image, use a generic placeholder
                            imageUrl = 'https://placehold.co/200x250/2d3748/e2e8f0?text=' + encodeURIComponent(item.Name);
                        }

                        const itemElement = document.createElement('div');
                        itemElement.className = 'carousel-item';
                        itemElement.innerHTML = `
                            <img src="${imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image';" alt="${item.Name}">
                            <div class="carousel-item-info">
                                <h3>${item.Name}</h3>
                            </div>
                        `;
                        carousel.appendChild(itemElement);
                    });
                } else {
                    carousel.innerHTML = `<p class="text-gray-400 text-center w-full">No categories found. Please configure Jellyfin or TMDb settings.</p>`;
                }
            } catch (error) {
                console.error("Error fetching categories:", error);
                carousel.innerHTML = `<p class="text-red-400 text-center w-full">${error.message}</p>`;
            } finally {
                hideLoadingSpinner('categoriesLoadingSpinner');
            }
        }

        /**
         * Fetches and displays Live TV Channels (or popular TV shows from TMDb as an alternative).
         */
        async function fetchAndDisplayLiveTvChannels() {
            showLoadingSpinner('liveTvLoadingSpinner');
            const carousel = document.getElementById('liveTvCarousel');
            carousel.innerHTML = '<div class="loading-spinner active" id="liveTvLoadingSpinner"></div>'; // Reset and show spinner
            const jellyfinServerUrl = localStorage.getItem('jellyfinServerUrl');
            const jellyfinApiKey = localStorage.getItem('jellyfinApiKey');
            const jellyfinUserId = localStorage.getItem('jellyfinUserId');
            const tmdbApiKey = localStorage.getItem('tmdbApiKey');

            try {
                let items = [];
                let source = 'unknown';

                if (jellyfinServerUrl && jellyfinApiKey) {
                    // Try fetching from Jellyfin first for actual Live TV channels
                    const jellyfinData = await fetchJellyfinData(
                        `LiveTv/Channels?UserId=${jellyfinUserId}`, // Removed Limit to fetch all live TV channels
                        jellyfinServerUrl,
                        jellyfinApiKey,
                        jellyfinUserId
                    );
                    if (jellyfinData && jellyfinData.Items && jellyfinData.Items.length > 0) {
                        items = jellyfinData.Items;
                        source = 'Jellyfin';
                    }
                }

                // If no Jellyfin Live TV or not configured, fallback to TMDb popular TV shows
                if (items.length === 0 && tmdbApiKey) {
                    const tmdbData = await fetchTMDbData('tv/popular', tmdbApiKey);
                    if (tmdbData && tmdbData.results && tmdbData.results.length > 0) {
                        items = tmdbData.results.slice(0, 10).map(item => ({
                            Name: item.name,
                            Id: item.id,
                            ImageTags: { Primary: item.poster_path },
                            ChannelType: 'Popular TV Show', // Custom field for display
                            ProductionYear: item.first_air_date ? new Date(item.first_air_date).getFullYear() : ''
                        }));
                        source = 'TMDb (Popular TV Shows)';
                    }
                }


                carousel.innerHTML = ''; // Clear spinner and previous items
                if (items.length > 0) {
                    items.forEach(item => {
                        let imageUrl;
                        if (source.startsWith('TMDb') && item.ImageTags.Primary) {
                            imageUrl = `${TMDB_IMAGE_BASE_URL}${item.ImageTags.Primary}`;
                        } else if (source === 'Jellyfin' && item.ImageTags.Primary) {
                            imageUrl = `${jellyfinServerUrl}/Items/${item.Id}/Images/Primary?tag=${item.ImageTags.Primary}&quality=90&maxWidth=200&maxHeight=250`;
                        } else {
                            imageUrl = 'https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image';
                        }

                        const itemElement = document.createElement('div');
                        itemElement.className = 'carousel-item';
                        itemElement.innerHTML = `
                            <img src="${imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/200x250/2d3748/e2e8f0?text=No+Image';" alt="${item.Name}">
                            <div class="carousel-item-info">
                                <h3>${item.Name}</h3>
                                <p>${item.ChannelType || item.ProductionYear || ''}</p>
                            </div>
                        `;
                        carousel.appendChild(itemElement);
                    });
                } else {
                    carousel.innerHTML = `<p class="text-gray-400 text-center w-full">No live TV channels or popular TV shows found. Please configure Jellyfin or TMDb settings.</p>`;
                }
            } catch (error) {
                console.error("Error fetching live TV channels/popular TV shows:", error);
                carousel.innerHTML = `<p class="text-red-400 text-center w-full">${error.message}</p>`;
            } finally {
                hideLoadingSpinner('liveTvLoadingSpinner');
            }
        }

        /**
         * Applies admin-specific settings (Jellyfin/TMDb API keys) from Firestore.
         * This function is called ONLY if the user has an 'admin' custom claim.
         */
        async function applyAdminSettings() {
            if (!isAuthReady || !userId) {
                console.log("Authentication not ready or userId not available, deferring applyAdminSettings.");
                return;
            }

            try {
                // Target the NEW adminSettings path as defined in Firestore rules
                const adminSettingsRef = doc(db, `artifacts/${appId}/adminSettings`, 'api_keys'); // Example: store keys in 'api_keys' document
                console.log(`Firestore: Attempting to load admin settings from path: ${adminSettingsRef.path}`);

                const docSnap = await getDoc(adminSettingsRef);

                if (docSnap.exists()) {
                    const settings = docSnap.data();
                    localStorage.setItem('jellyfinServerUrl', settings.serverUrl || '');
                    localStorage.setItem('jellyfinApiKey', settings.apiKey || '');
                    localStorage.setItem('jellyfinUserId', settings.userId || '');
                    localStorage.setItem('tmdbApiKey', settings.tmdbApiKey || '');

                    document.getElementById('jellyfinUrlInput').value = settings.serverUrl || '';
                    document.getElementById('jellyfinApiKeyInput').value = settings.apiKey || '';
                    document.getElementById('jellyfinUserIdInput').value = settings.userId || '';
                    document.getElementById('tmdbApiKeyInput').value = settings.tmdbApiKey || '';

                    console.log("Admin Jellyfin and TMDb settings loaded from Firestore.");
                } else {
                    console.warn("No admin settings found in Firestore. Admin users will need to save them.");
                }
            } catch (error) {
                console.error("Error loading admin settings from Firestore:", error);
                showMessageBox('Firestore Error', `Failed to load admin settings: ${error.message}. Check Firebase rules and admin claims.`);
            } finally {
                // Always attempt to fetch data after settings are loaded or attempted to load
                // This will use the (potentially empty) settings from localStorage
                fetchAndSetupHeroSlideshow();
                fetchAndDisplayLatestReleases();
                fetchAndDisplayLiveTvChannels();
                fetchAndDisplayCategories();
            }
        }

        /**
         * Applies content without specific admin settings (e.g., if no admin is logged in, or settings not yet saved).
         * This function is called for non-admin users or if no admin settings are found/loaded.
         * It primarily relies on settings already present in localStorage (saved by an admin previously).
         */
        async function applyPublicContent() {
            console.log("Applying public content logic.");
            // For public users, settings inputs in the UI should be cleared or disabled
            // as they cannot modify admin-level settings.
            document.getElementById('jellyfinUrlInput').value = '';
            document.getElementById('jellyfinApiKeyInput').value = '';
            document.getElementById('jellyfinUserIdInput').value = '';
            document.getElementById('tmdbApiKeyInput').value = '';

            // Optionally, disable the input fields for non-admins
            document.getElementById('jellyfinUrlInput').disabled = true;
            document.getElementById('jellyfinApiKeyInput').disabled = true;
            document.getElementById('jellyfinUserIdInput').disabled = true;
            document.getElementById('tmdbApiKeyInput').disabled = true;
            document.getElementById('saveSettingsButton').disabled = true;
            document.getElementById('clearSettingsButton').disabled = true;


            // Load content based on whatever is in localStorage (which an admin would have set)
            fetchAndSetupHeroSlideshow();
            fetchAndDisplayLatestReleases();
            fetchAndDisplayLiveTvChannels();
            fetchAndDisplayCategories();
        }


        /**
         * Cleans a URL to extract only the base URL (protocol, domain, port).
         * @param {string} url - The URL to clean.
         * @returns {string} The cleaned base URL.
         */
        function cleanJellyfinUrl(url) {
            try {
                const urlObj = new URL(url);
                // Reconstruct the base URL: protocol + hostname + (port if not default)
                let baseUrl = `${urlObj.protocol}//${urlObj.hostname}`;
                if (urlObj.port) {
                    baseUrl += `:${urlObj.port}`;
                }
                return baseUrl;
            } catch (e) {
                console.warn("Invalid URL provided, returning original string:", url, e);
                return url; // Return original if URL is completely malformed
            }
        }

        /**
         * Saves Jellyfin and TMDb settings to Firestore and localStorage.
         * MODIFIED: Now targets the adminSettings path, requires admin claim to save.
         */
        async function saveSettings() {
            // Check if the current user has admin claims before allowing save
            if (!auth.currentUser || !auth.currentUser.uid) {
                showMessageBox('Authentication Error', 'You must be signed in to save settings.');
                return;
            }
            const idTokenResult = await auth.currentUser.getIdTokenResult();
            if (!idTokenResult.claims.admin) {
                showMessageBox('Permission Denied', 'You do not have administrative privileges to save these settings.');
                return;
            }

            let jellyfinUrl = document.getElementById('jellyfinUrlInput').value.trim();
            const jellyfinApiKey = document.getElementById('jellyfinApiKeyInput').value.trim();
            const jellyfinUserId = document.getElementById('jellyfinUserIdInput').value.trim();
            const tmdbApiKey = document.getElementById('tmdbApiKeyInput').value.trim();

            if (!jellyfinUrl && !tmdbApiKey) {
                showMessageBox('Error', 'Please provide either Jellyfin Server URL/API Key or a TMDb API Key.');
                return;
            }

            if (jellyfinUrl) {
                jellyfinUrl = cleanJellyfinUrl(jellyfinUrl);
            }

            // Save to localStorage so even non-admins can view content after an admin saves
            localStorage.setItem('jellyfinServerUrl', jellyfinUrl);
            localStorage.setItem('jellyfinApiKey', jellyfinApiKey);
            localStorage.setItem('jellyfinUserId', jellyfinUserId);
            localStorage.setItem('tmdbApiKey', tmdbApiKey);

            try {
                // Target the NEW adminSettings path
                const adminSettingsRef = doc(db, `artifacts/${appId}/adminSettings`, 'api_keys'); // Save to 'api_keys' document
                console.log(`Firestore: Attempting to save admin settings to path: ${adminSettingsRef.path}`);

                await setDoc(adminSettingsRef, {
                    serverUrl: jellyfinUrl,
                    apiKey: jellyfinApiKey,
                    userId: jellyfinUserId,
                    tmdbApiKey: tmdbApiKey,
                    timestamp: new Date()
                }, { merge: true });
                showMessageBox('Success', 'Admin settings saved successfully to cloud!');
                console.log("Admin Jellyfin and TMDb settings saved to Firestore.");
            } catch (error) {
                console.error("Error saving admin settings to Firestore:", error);
                showMessageBox('Error', `Failed to save admin settings to cloud: ${error.message}. Check Firebase rules and admin claims.`);
            } finally {
                closeLumaPanel();
                fetchAndSetupHeroSlideshow();
                fetchAndDisplayLatestReleases();
                fetchAndDisplayLiveTvChannels();
                fetchAndDisplayCategories();
            }
        }

        /**
         * Clears Jellyfin and TMDb settings from localStorage and Firestore.
         * MODIFIED: Now targets the adminSettings path, requires admin claim to clear.
         */
        async function clearSettings() {
            // Check if the current user has admin claims before allowing clear
            if (!auth.currentUser || !auth.currentUser.uid) {
                showMessageBox('Authentication Error', 'You must be signed in to clear settings.');
                return;
            }
            const idTokenResult = await auth.currentUser.getIdTokenResult();
            if (!idTokenResult.claims.admin) {
                showMessageBox('Permission Denied', 'You do not have administrative privileges to clear these settings.');
                return;
            }

            localStorage.removeItem('jellyfinServerUrl');
            localStorage.removeItem('jellyfinApiKey');
            localStorage.removeItem('jellyfinUserId');
            localStorage.removeItem('tmdbApiKey');

            document.getElementById('jellyfinUrlInput').value = '';
            document.getElementById('jellyfinApiKeyInput').value = '';
            document.getElementById('jellyfinUserIdInput').value = '';
            document.getElementById('tmdbApiKeyInput').value = '';

            try {
                // Target the NEW adminSettings path
                const adminSettingsRef = doc(db, `artifacts/${appId}/adminSettings`, 'api_keys'); // Clear from 'api_keys' document
                await setDoc(adminSettingsRef, { serverUrl: '', apiKey: '', userId: '', tmdbApiKey: '' }, { merge: true });
                showMessageBox('Success', 'Admin settings cleared successfully from cloud!');
                console.log("Admin Jellyfin and TMDb settings cleared from Firestore.");
            } catch (error) {
                console.error("Error clearing admin settings from Firestore:", error);
                showMessageBox('Error', `Failed to clear admin settings from cloud: ${error.message}`);
            } finally {
                closeLumaPanel();
                fetchAndSetupHeroSlideshow();
                fetchAndDisplayLatestReleases();
                fetchAndDisplayLiveTvChannels();
                fetchAndDisplayCategories();
            }
        }

        /**
         * Toggles the visibility of the settings panel.
         */
        function toggleLumaPanel() {
            const settingsPanel = document.getElementById('settingsPanel');
            console.log("toggleLumaPanel called. Current classes:", settingsPanel.classList);
            settingsPanel.classList.toggle('open');
            console.log("After toggling 'open' class. New classes:", settingsPanel.classList);
        }

        /**
         * Closes the settings panel.
         */
        function closeLumaPanel() {
            const settingsPanel = document.getElementById('settingsPanel');
            console.log("closeLumaPanel called. Current classes:", settingsPanel.classList);
            settingsPanel.classList.remove('open');
            console.log("After removing 'open' class. New classes:", settingsPanel.classList);
        }

        /**
         * Opens the authentication modal.
         */
        function openAuthBox() {
            const authBox = document.getElementById('authBox');
            document.getElementById('authErrorMessage').style.display = 'none'; // Clear previous errors
            authBox.style.display = 'flex';
            setTimeout(() => {
                authBox.classList.add('open');
            }, 10);
        }

        /**
         * Closes the authentication modal.
         */
        function closeAuthBox() {
            const authBox = document.getElementById('authBox');
            authBox.classList.remove('open');
            setTimeout(() => {
                authBox.style.display = 'none';
            }, 300);
        }

        /**
         * Handles user sign-in.
         */
        async function handleSignIn() {
            const email = document.getElementById('authEmailInput').value;
            const password = document.getElementById('authPasswordInput').value;
            const authErrorMessage = document.getElementById('authErrorMessage');
            authErrorMessage.style.display = 'none'; // Clear previous errors

            if (!email || !password) {
                authErrorMessage.textContent = 'Please enter both email and password.';
                authErrorMessage.style.display = 'block';
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
                closeAuthBox(); // Close auth box on successful sign-in
                showMessageBox('Sign In Success', 'You have been successfully signed in!');
            } catch (error) {
                console.error("Error signing in:", error);
                let errorMessage = 'Sign in failed.';
                switch (error.code) {
                    case 'auth/user-not-found':
                    case 'auth/wrong-password':
                        errorMessage = 'Invalid email or password.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email format.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Too many sign-in attempts. Please try again later.';
                        break;
                    default:
                        errorMessage = `Error: ${error.message}`;
                }
                authErrorMessage.textContent = errorMessage;
                authErrorMessage.style.display = 'block';
            }
        }

        /**
         * Handles user sign-up.
         */
        async function handleSignUp() {
            const email = document.getElementById('authEmailInput').value;
            const password = document.getElementById('authPasswordInput').value;
            const authErrorMessage = document.getElementById('authErrorMessage');
            authErrorMessage.style.display = 'none'; // Clear previous errors

            if (!email || !password) {
                authErrorMessage.textContent = 'Please enter both email and password.';
                authErrorMessage.style.display = 'block';
                return;
            }
            if (password.length < 6) {
                authErrorMessage.textContent = 'Password must be at least 6 characters long.';
                authErrorMessage.style.display = 'block';
                return;
            }

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                closeAuthBox(); // Close auth box on successful sign-up
                showMessageBox('Sign Up Success', 'Account created successfully! You are now signed in.');
                // Note: New users do NOT automatically get admin claims.
                // An existing admin must set the 'admin: true' claim for them via the Firebase backend.
            } catch (error) {
                console.error("Error signing up:", error);
                let errorMessage = 'Sign up failed.';
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'This email is already registered.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email format.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Password is too weak. Must be at least 6 characters.';
                        break;
                    default:
                        errorMessage = `Error: ${error.message}`;
                }
                authErrorMessage.textContent = errorMessage;
                authErrorMessage.style.display = 'block';
            }
        }

        /**
         * Handles sending a password reset email.
         */
        async function handleForgotPassword() {
            const email = document.getElementById('authEmailInput').value;
            const authErrorMessage = document.getElementById('authErrorMessage');
            authErrorMessage.style.display = 'none'; // Clear previous errors

            if (!email) {
                authErrorMessage.textContent = 'Please enter your email to reset password.';
                authErrorMessage.style.display = 'block';
                return;
            }

            try {
                await sendPasswordResetEmail(auth, email);
                showMessageBox('Password Reset', 'If an account exists for that email, a password reset link has been sent to your inbox.');
                closeAuthBox(); // Close auth box after sending reset email
            } catch (error) {
                console.error("Error sending password reset email:", error);
                let errorMessage = 'Failed to send password reset email.';
                switch (error.code) {
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email format.';
                        break;
                    case 'auth/user-not-found':
                        // For security, Firebase recommends not revealing if an email exists.
                        // So, we give a generic message similar to success.
                        showMessageBox('Password Reset', 'If an account exists for that email, a password reset link has been sent to your inbox.');
                        closeAuthBox();
                        return; // Exit here as we've shown the message
                    default:
                        errorMessage = `Error: ${error.message}`;
                }
                authErrorMessage.textContent = errorMessage;
                authErrorMessage.style.display = 'block';
            }
        }

        /**
         * Handles user sign-out.
         */
        async function handleSignOut() {
            try {
                console.log("Attempting to sign out...");
                await signOut(auth);
                console.log("Sign out successful.");
                showMessageBox('Sign Out Success', 'You have been successfully signed out.');
            } catch (error) {
                console.error("Error signing out:", error);
                showMessageBox('Sign Out Error', `Failed to sign out: ${error.message}`);
            }
        }

        /**
         * Scrolls a given carousel element left or right.
         * @param {HTMLElement} carouselElement - The HTML element of the carousel container.
         * @param {string} direction - 'left' or 'right'.
         */
        function scrollCarousel(carouselElement, direction) {
            const scrollAmount = 600; // Adjust this value to change scroll distance
            if (direction === 'left') {
                carouselElement.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
            } else {
                carouselElement.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            }
        }


        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase(); // Initialize Firebase on DOM load

            // Settings button listener
            document.getElementById('settingsButton').addEventListener('click', () => {
                console.log("Settings button clicked.");
                toggleLumaPanel();
            });

            // Save and Clear settings buttons
            document.getElementById('saveSettingsButton').addEventListener('click', saveSettings);
            document.getElementById('clearSettingsButton').addEventListener('click', clearSettings);

            // Close settings panel button
            document.getElementById('closeSettingsPanelBtn').addEventListener('click', () => {
                console.log("Settings panel 'X' button clicked.");
                closeLumaPanel();
            });

            // Message box OK button
            document.getElementById('messageBoxOkBtn').addEventListener('click', () => {
                console.log("Message box 'OK' button clicked.");
                closeMessageBox();
            });

            // Message box X button
            document.getElementById('closeMessageBoxBtn').addEventListener('click', () => {
                console.log("Message box 'X' button clicked.");
                closeMessageBox();
            });

            // Auth button (Sign In / Sign Out toggle)
            document.getElementById('authButton').addEventListener('click', () => {
                if (auth.currentUser && !auth.currentUser.isAnonymous) { // Only sign out if an actual user is logged in
                    handleSignOut();
                } else {
                    openAuthBox();
                }
            });

            // Auth box buttons
            document.getElementById('signInButton').addEventListener('click', handleSignIn);
            document.getElementById('signUpButton').addEventListener('click', handleSignUp);
            document.getElementById('closeAuthBoxBtn').addEventListener('click', closeAuthBox);
            // Add event listener for Forgot Password link
            document.getElementById('forgotPasswordLink').addEventListener('click', (event) => {
                event.preventDefault(); // Prevent default link behavior
                handleForgotPassword();
            });

            // Carousel Navigation Arrows Event Listeners
            document.getElementById('latestReleasesLeftArrow').addEventListener('click', () => {
                scrollCarousel(document.getElementById('latestReleasesCarousel'), 'left');
            });
            document.getElementById('latestReleasesRightArrow').addEventListener('click', () => {
                scrollCarousel(document.getElementById('latestReleasesCarousel'), 'right');
            });

            document.getElementById('categoriesLeftArrow').addEventListener('click', () => {
                scrollCarousel(document.getElementById('categoriesCarousel'), 'left');
            });
            document.getElementById('categoriesRightArrow').addEventListener('click', () => {
                scrollCarousel(document.getElementById('categoriesCarousel'), 'right');
            });

            document.getElementById('liveTvLeftArrow').addEventListener('click', () => {
                scrollCarousel(document.getElementById('liveTvCarousel'), 'left');
            });
            document.getElementById('liveTvRightArrow').addEventListener(() => {
                scrollCarousel(document.getElementById('liveTvCarousel'), 'right');
            });
        });

    </script>


</body></html>